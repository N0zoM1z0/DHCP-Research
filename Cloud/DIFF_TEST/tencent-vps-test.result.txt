ubuntu@VM-0-13-ubuntu:~/DHCP-Research/Routers/DIFF_TEST$ sudo python3 dhcp_differential_tester.py 

[===] 开始测试目标: VPS DHCP (网卡: eth0) [===]

[>>>] 正在执行测试套件: '标准DORA流程' [<<<]

================================================================================
DHCP 测试报告: 标准DORA流程
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
completeness_score       : 8
lease_time               : 4294967295
missing_options          : ['DNS服务器']
name_server              : N/A
router                   : 172.19.0.1
server_ip                : 172.19.0.1
subnet_mask              : 255.255.240.0

--- DHCP服务完整性分析 ---
完整性得分: 8/10
缺少选项: DNS服务器
================================================================================

[>>>] 正在执行测试套件: 'Option 12 主机名测试' [<<<]

================================================================================
DHCP 测试报告: Option 12 主机名测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
dns_registered           : 否
hostname                 : my-test-pc
resolved_ip              : N/A
server_ip                : 172.19.0.1
================================================================================

[>>>] 正在执行测试套件: 'Option 81 FQDN测试' [<<<]

================================================================================
DHCP 测试报告: Option 81 FQDN测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
dns_registered           : 否
fqdn                     : my-fqdn-pc.local
option81_support         : 否
resolved_ip              : N/A
server_ip                : 172.19.0.1
================================================================================

[>>>] 正在执行测试套件: 'Option 114 强制门户测试' [<<<]

================================================================================
DHCP 测试报告: Option 114 强制门户测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
option114_content        : N/A
option114_in_ack         : 否
option114_support        : 否
server_ip                : 172.19.0.1
================================================================================

[>>>] 正在执行测试套件: 'Option 121 静态路由测试' [<<<]

================================================================================
DHCP 测试报告: Option 121 静态路由测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
option121_in_ack         : 否
option121_support        : 否
server_ip                : 172.19.0.1
static_routes            : N/A
================================================================================

[>>>] 正在执行测试套件: '健壮性-未知选项测试' [<<<]

================================================================================
DHCP 测试报告: 健壮性-未知选项测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
response_type            : ACK
robustness_score         : 10
unknown_option_tolerance : 高 (优雅地忽略未知选项)
================================================================================

[>>>] 正在执行测试套件: '健壮性-畸形选项测试' [<<<]

================================================================================
DHCP 测试报告: 健壮性-畸形选项测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
hostname_in_ack          : 选项被忽略
malformed_option_handling: 谨慎 (接受请求但忽略了畸形选项)
robustness_score         : 9
================================================================================

[>>>] 正在执行测试套件: 'Option 61 客户端标识符测试' [<<<]

================================================================================
DHCP 测试报告: Option 61 客户端标识符测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
client_id_priority       : 使用客户端标识符 (Option 61) 作为主要标识
custom_id_support        : 是
identification_policy    : 基于客户端标识符
mac_change_handling      : 接受
option61_support         : 是
server_ip                : 172.19.0.1
standard_id_support      : 是
================================================================================

[>>>] 正在执行测试套件: 'Option 60 厂商类型标识符测试' [<<<]
  -- 测试厂商标识: MSFT 5.0
  -- 测试厂商标识: android-dhcp-10
  -- 测试厂商标识: HUAWEI:STB
  -- 测试厂商标识: IPTV_STB
  -- 测试厂商标识: ArubaAP
  -- 测试厂商标识: udhcp 1.19.4

================================================================================
DHCP 测试报告: Option 60 厂商类型标识符测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
analysis                 : []
option43_responses       : {}
option43_support         : 否
special_vci_handling     : 否
test_details             : {'MSFT 5.0': {'status': '失败', 'reason': '未收到 DHCP ACK', 'vci': 'MSFT 5.0', 'vci_support': '未知'}, 'android-dhcp-10': {'status': '失败', 'reason': '未收到 DHCP ACK', 'vci': 'android-dhcp-10', 'vci_support': '未知'}, 'HUAWEI:STB': {'status': '成功', 'assigned_ip': '172.19.0.13', 'server_ip': '172.19.0.1', 'vci': 'HUAWEI:STB', 'vci_support': '是', 'option43_in_offer': '否', 'option43_in_ack': '否'}, 'IPTV_STB': {'status': '成功', 'assigned_ip': '172.19.0.13', 'server_ip': '172.19.0.1', 'vci': 'IPTV_STB', 'vci_support': '是', 'option43_in_offer': '否', 'option43_in_ack': '否'}, 'ArubaAP': {'status': '成功', 'assigned_ip': '172.19.0.13', 'server_ip': '172.19.0.1', 'vci': 'ArubaAP', 'vci_support': '是', 'option43_in_offer': '否', 'option43_in_ack': '否'}, 'udhcp 1.19.4': {'status': '成功', 'assigned_ip': '172.19.0.13', 'server_ip': '172.19.0.1', 'vci': 'udhcp 1.19.4', 'vci_support': '是', 'option43_in_offer': '否', 'option43_in_ack': '否'}}
vci_handling_description : 路由器接受所有VCI但没有特殊处理
vci_tests_total          : 6
vci_with_option43_responses: 0
================================================================================

[>>>] 正在执行测试套件: 'Option 43 厂商特定信息测试' [<<<]
  -- 测试VCI与Option 43关联: MSFT 5.0
  -- 测试VCI与Option 43关联: IPTV_STB
  -- 测试VCI与Option 43关联: HUAWEI:STB
  -- 测试VCI与Option 43关联: ArubaAP
  -- 测试VCI与Option 43关联: Cisco Systems
  -- 测试VCI与Option 43关联: VOIP
  -- 测试VCI与Option 43关联: UBNT
  -- 测试VCI与Option 43关联: HP AP
  -- 测试VCI与Option 43关联: TP-LINK

================================================================================
DHCP 测试报告: Option 43 厂商特定信息测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
analysis                 : 路由器不对任何测试的厂商ID返回特定信息
option43_responses       : {}
option43_support         : 否
responsive_vci_count     : 0
responsive_vcis          : []
test_details             : {'MSFT 5.0': {'status': '成功', 'vci': 'MSFT 5.0', 'option43_in_offer': '否', 'option43_in_ack': '否', 'option43_received': '否'}, 'IPTV_STB': {'status': '成功', 'vci': 'IPTV_STB', 'option43_in_offer': '否', 'option43_in_ack': '否', 'option43_received': '否'}, 'HUAWEI:STB': {'status': '成功', 'vci': 'HUAWEI:STB', 'option43_in_offer': '否', 'option43_in_ack': '否', 'option43_received': '否'}, 'ArubaAP': {'status': '成功', 'vci': 'ArubaAP', 'option43_in_offer': '否', 'option43_in_ack': '否', 'option43_received': '否'}, 'Cisco Systems': {'status': '成功', 'vci': 'Cisco Systems', 'option43_in_offer': '否', 'option43_in_ack': '否', 'option43_received': '否'}, 'VOIP': {'status': '成功', 'vci': 'VOIP', 'option43_in_offer': '否', 'option43_in_ack': '否', 'option43_received': '否'}, 'UBNT': {'status': '成功', 'vci': 'UBNT', 'option43_in_offer': '否', 'option43_in_ack': '否', 'option43_received': '否'}, 'HP AP': {'status': '成功', 'vci': 'HP AP', 'option43_in_offer': '否', 'option43_in_ack': '否', 'option43_received': '否'}, 'TP-LINK': {'status': '成功', 'vci': 'TP-LINK', 'option43_in_offer': '否', 'option43_in_ack': '否', 'option43_received': '否'}}
vci_tested               : 9
================================================================================

[>>>] 正在执行测试套件: 'Option 42 NTP服务器测试' [<<<]

================================================================================
DHCP 测试报告: Option 42 NTP服务器测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
ntp_analysis             : 未提供NTP服务器
ntp_count                : 0
ntp_server_count         : 0
ntp_servers              : N/A
option42_in_ack          : 否
option42_in_offer        : 否
option42_support         : 否
server_ip                : 172.19.0.1
================================================================================

[>>>] 正在执行测试套件: 'Option 66/67 PXE引导测试' [<<<]

================================================================================
DHCP 测试报告: Option 66/67 PXE引导测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
bootfile_name            : N/A
bootp_file_used          : 否
bootp_siaddr_used        : 是
option66_in_ack          : 是
option66_in_offer        : 是
option66_support         : 是
option67_in_ack          : 否
option67_in_offer        : 否
option67_support         : 否
pxe_support_level        : 部分支持 (仅提供TFTP服务器)
server_ip                : 172.19.0.1
tftp_server              : 172.19.0.1
================================================================================

[>>>] 正在执行测试套件: 'Option 57 最大消息大小测试' [<<<]

================================================================================
DHCP 测试报告: Option 57 最大消息大小测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
ack_size                 : 342
assigned_ip              : 172.19.0.13
compliance_details       : 完全忽略最大消息大小限制
max_size_declared        : 300
offer_size               : 342
option57_compliance      : 不遵循
option_count             : 8
respects_max_size_ack    : 否
respects_max_size_offer  : 否
server_ip                : 172.19.0.1
size_optimization        : 是
================================================================================

[>>>] 正在执行测试套件: 'Option 82 中继代理信息测试' [<<<]

================================================================================
DHCP 测试报告: Option 82 中继代理信息测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
option82_handling        : 忽略 (Strip)
option82_in_ack          : 否
option82_in_offer        : 否
security_posture         : 一般 (接受但不回显，属于宽容模式)
security_score           : 5
server_ip                : 172.19.0.1

--- 安全性分析 ---
安全评分: 5/10
================================================================================

[>>>] 正在执行测试套件: '租约操纵-伪造释放测试' [<<<]
  -- 使用伪造MAC f2:84:8d:63:a9:88 尝试释放IP 172.19.0.13

================================================================================
DHCP 测试报告: 租约操纵-伪造释放测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
fake_mac_used            : f2:84:8d:63:a9:88
ip_after_spoof           : 172.19.0.13
original_ip              : 172.19.0.13
same_ip_reused           : 是
security_posture         : 安全 (服务器忽略了来自错误MAC的Release请求)
security_score           : 10
spoof_release_vulnerable : 否

--- 安全性分析 ---
安全评分: 10/10
================================================================================

[>>>] 正在执行测试套件: '资源耗尽-DHCP饥饿攻击测试' [<<<]
  -- 开始执行饥饿攻击测试，将尝试 30 次...
  -- 已完成 5/30 次攻击，成功消耗了 5 个IP地址
  -- 已完成 10/30 次攻击，成功消耗了 10 个IP地址
  -- 已完成 15/30 次攻击，成功消耗了 15 个IP地址
  -- 已完成 20/30 次攻击，成功消耗了 20 个IP地址
  -- 已完成 25/30 次攻击，成功消耗了 25 个IP地址
  -- 已完成 30/30 次攻击，成功消耗了 30 个IP地址
  -- 饥饿攻击测试完成，成功消耗了 30 个IP地址
  -- 分配的IP范围: 0.0.0.0 - 172.19.0.13
  -- 使用真实MAC 52:54:00:48:a1:94 尝试获取IP...

================================================================================
DHCP 测试报告: 资源耗尽-DHCP饥饿攻击测试
================================================================================
测试状态: 部分成功
失败原因: 在饥饿攻击后收到OFFER但未收到ACK

[>>>] 正在执行测试套件: 'Option 50 客户端指定IP测试' [<<<]

================================================================================
DHCP 测试报告: Option 50 客户端指定IP测试
================================================================================
测试状态: 失败
失败原因: 未收到 DHCP ACK

[>>>] 正在执行测试套件: 'Option 80 快速提交测试' [<<<]
  -- 等待服务器响应，可能是标准的OFFER或直接ACK...
  -- 收到DHCP OFFER，服务器不支持Rapid Commit

================================================================================
DHCP 测试报告: Option 80 快速提交测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
dora_steps               : 4步 (标准DORA)
efficiency_optimization  : 无
note                     : 服务器不支持Rapid Commit，使用了标准的DORA流程
option80_support         : 否
performance_rating       : 5
rapid_commit_enabled     : 否
================================================================================

[>>>] 正在执行测试套件: 'Option 77 用户类别测试' [<<<]
  -- 基准测试: 获得IP 172.19.0.13
  -- 测试用户类: guest
  -- 测试用户类: gaming
  -- 测试用户类: streaming
  -- 测试用户类: iot
  -- 测试用户类: voice
  -- 测试用户类: admin
  -- 测试用户类: work-from-home

================================================================================
DHCP 测试报告: Option 77 用户类别测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
base_ip                  : 172.19.0.13
option77_support         : 否
special_policies_found   : 0
special_user_classes     : []
user_class_responses     : {'guest': {'status': '标准策略', 'assigned_ip': '172.19.0.13', 'note': '与基准配置相同'}, 'gaming': {'status': '标准策略', 'assigned_ip': '172.19.0.13', 'note': '与基准配置相同'}, 'streaming': {'status': '标准策略', 'assigned_ip': '172.19.0.13', 'note': '与基准配置相同'}, 'iot': {'status': '标准策略', 'assigned_ip': '172.19.0.13', 'note': '与基准配置相同'}, 'voice': {'status': '标准策略', 'assigned_ip': '172.19.0.13', 'note': '与基准配置相同'}, 'admin': {'status': '标准策略', 'assigned_ip': '172.19.0.13', 'note': '与基准配置相同'}, 'work-from-home': {'status': '标准策略', 'assigned_ip': '172.19.0.13', 'note': '与基准配置相同'}}
user_class_sensitivity   : 无
user_classes_tested      : 7
================================================================================

[>>>] 正在执行测试套件: 'Option 33 静态路由(旧)测试' [<<<]

================================================================================
DHCP 测试报告: Option 33 静态路由(旧)测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
backward_compatibility   : 低
code_age                 : 现代 (仅支持Option 121)
code_age_details         : 路由器DHCP服务不支持老式Option 33，可能是较新的代码库
option33_in_ack          : 否
option33_support         : 否
server_ip                : 172.19.0.1
static_routes            : N/A
================================================================================

[>>>] 正在执行测试套件: 'Option 119 域名搜索列表测试' [<<<]

================================================================================
DHCP 测试报告: Option 119 域名搜索列表测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
dns_flexibility          : 低
dns_integration          : 低
domain_name              : N/A
domain_search_list       : N/A
multi_domain_support     : 否
option119_support        : 否
option15_support         : 否
server_ip                : 172.19.0.1
================================================================================

[>>>] 正在执行测试套件: '租约续订时序攻击测试' [<<<]
  -- 成功获取IP: 172.19.0.13
  -- 租约时间: 4294967295秒
  -- 标准续约时间点T1: 2147483647.5秒后
  -- 但我们将在获取IP后立即尝试续约...
  -- 监听网络以捕获现有DHCP客户端信息...
  -- 未能通过监听捕获到DHCP客户端，尝试其他方式...
  -- 找到受害者客户端: IP=172.19.0.134, MAC=fe:ee:54:cb:79:fb
  -- 服务器IP: 172.19.0.1
  -- 发送伪造的续约请求 (XID: 0xd8ef9bc6)

================================================================================
DHCP 测试报告: 租约续订时序攻击测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
early_renewal_details    : {'status': '成功', 'assigned_ip': '172.19.0.13', 'original_lease_time': 4294967295, 'renewal_response': 'ACK', 'new_lease_time': 4294967295, 'early_renewal_permitted': '是', 'timing_strictness': '低 (接受过早续约请求)', 'timing_security': '低', 'time_validation': '否', 'notes': '服务器接受了过早的续约请求，这可能表明它没有进行时序验证'}
early_renewal_permitted  : 是
overall_renewal_security : 中
source_validation        : 是
space_security_level     : 高
spoofed_renewal_details  : {'status': '成功', 'spoofed_ip': '172.19.0.134', 'spoofed_mac': 'fe:ee:54:cb:79:fb', 'renewal_response': '无响应', 'spoofing_possible': '否', 'source_validation': '是', 'security_level': '高', 'notes': '服务器正确地忽略了来自错误源的续约请求'}
spoofing_possible        : 否
time_security_level      : 低
time_validation          : 否
================================================================================

[>>>] 正在执行测试套件: '跨子网IP请求测试' [<<<]
  -- 标准DISCOVER获得IP: 172.19.0.13
  -- 当前网络前缀: 172.19.0
  -- 测试伪造中继IP: 172.16.0.1
  -- 测试伪造中继IP: 172.31.0.1
  -- 测试伪造中继IP: 10.1.1.1
  -- 测试伪造中继IP: 192.168.10.1

================================================================================
DHCP 测试报告: 跨子网IP请求测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
security_notes           : 服务器正确拒绝了所有伪造中继的请求
standard_network         : 172.19.0
subnet_leakage_detected  : 否
test_details             : [{'fake_relay': '172.16.0.1', 'response': '无响应', 'subnet_leakage': '否', 'notes': '服务器正确地忽略了带伪造giaddr的请求'}, {'fake_relay': '172.31.0.1', 'response': '无响应', 'subnet_leakage': '否', 'notes': '服务器正确地忽略了带伪造giaddr的请求'}, {'fake_relay': '10.1.1.1', 'response': '无响应', 'subnet_leakage': '否', 'notes': '服务器正确地忽略了带伪造giaddr的请求'}, {'fake_relay': '192.168.10.1', 'response': '无响应', 'subnet_leakage': '否', 'notes': '服务器正确地忽略了带伪造giaddr的请求'}]
tested_relay_ips         : ['172.16.0.1', '172.31.0.1', '10.1.1.1', '192.168.10.1']
topology_security_level  : 高
================================================================================

[>>>] 正在执行测试套件: 'BOOTP遗留协议回退测试' [<<<]

================================================================================
DHCP 测试报告: BOOTP遗留协议回退测试
================================================================================
测试状态: 成功

--- 详细测试结果 ---
assigned_ip              : 172.19.0.13
bootp_support            : 是
code_age                 : 老 (1993-2000, 早期BOOTP扩展)
dhcp_vs_bootp            : 相同IP分配策略
is_pure_bootp            : 是
legacy_code_presence     : 极可能
malformed_bootp_handling : 拒绝响应 (安全)
security_concern         : 低
validation_quality       : 高
================================================================================

[>>>] 正在执行测试套件: '选项重载字段损坏攻击' [<<<]

================================================================================
DHCP 测试报告: 选项重载字段损坏攻击
================================================================================
测试状态: 成功

--- 详细测试结果 ---
parser_robustness        : 高
security_assessment      : 服务器对DHCP选项溢出攻击具有良好的防御能力
server_crashed           : 否
tests_passed             : 5
tests_run                : 5
vulnerabilities          : []
================================================================================

[>>>] 正在执行测试套件: 'IP分片攻击' [<<<]

================================================================================
DHCP 测试报告: IP分片攻击
================================================================================
测试状态: 失败
失败原因: 路由器 172.19.0.1 在测试开始前就无法ping通


[===] VPS DHCP服务器特性和安全分析摘要 [===]

--- 选项支持情况汇总 ---
路由器名称           | 选项12       | 选项81       | 选项114      | 选项121      | DNS注册      | NTP服务      | TFTP服务     | 引导文件      
--------------------------------------------------------------------------------------------------------------
VPS DHCP        | 否          | 否          | 否          | 否          | 否          | 否          | 是          | 否         

--- 安全与边界测试结果 ---
路由器名称           | 最大消息大小(选项57)              | 中继代理信息(选项82)             
----------------------------------------------------------------------
VPS DHCP        | 不遵循                       | 忽略 (Strip)               

--- 状态机与资源管理测试结果 ---
路由器名称           | 伪造释放攻击易受性            | DHCP饥饿攻击抵抗力          | 客户端指定IP策略                
-------------------------------------------------------------------------------------
VPS DHCP        | 否                    | 未测试                  | 未测试                      

--- 协议实现年代与完整性测试结果 ---
路由器名称           | Rapid Commit    | 用户类别敏感度         | 静态路由(旧)         | 域名搜索列表         
--------------------------------------------------------------------------------
VPS DHCP        | 否               | 无               | 否               | 否              

--- 时空维度安全测试结果 ---
路由器名称           | 续约时序验证          | 续约源验证           | 子网信息泄露          | 拓扑安全级别         
--------------------------------------------------------------------------------
VPS DHCP        | 未测试             | 未测试             | 未测试             | 未测试            

--- 协议方言与结构完整性测试结果 ---
路由器名称           | BOOTP支持         | 协议验证质量          | 选项解析健壮性         | 网络栈健壮性         
--------------------------------------------------------------------------------
VPS DHCP        | 是               | 高               | 高               | 未测试            
ubuntu@VM-0-13-ubuntu:~/DHCP-Research/Routers/DIFF_TEST$ 
